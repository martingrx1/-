# 异步

## 1. 同步和异步
什么是同步:  
同步指的是任务按住顺序一个一个的完成,前一个没有完成下一个就不能开始进行,会发生任务堵塞

什么是异步:  
异步指的是,任务在按照顺序进行时,若其中一个任务因为某些原因(执行时间过长.发生错误)等,从而跳过这个任务去执行后面的任务,无需等待这个特殊任务执行结果,这个叫做异步,能解决任务堵塞


## 2. JS中的异步
js中的异步一般是用回调函数来解决

### 回调函数
```
 function callback(){
     console.log(1)
 }
 setTimeOut(callback,1000);  //其中 callback就称作回调函数,在达成某一条件后执行
                            // 该例子的条件是时间过了定时器的1000毫秒 (不严谨)
```
由上可知,回调函数就是我们人为规定的,在达到某些条件后,才执行的函数,一般有网络请求成功、定时器等

## 3.事件循环

### 执行栈 (原理在运行机制一章)
JS事件执行时,会按照顺序压入执行栈中,按照先进后出的顺序,一个一个地执行任务

### 任务队列 / 消息队列 (Set集合)
当执行栈中的同步任务执行时,发现存在异步任务,在异步任务得到结果后,**将异步任务注册的回调函数存放**,于是就有一个地方专门存储这种回调函数,这个地方叫做任务队列

### 事件循环
JS主线程会首先往执行栈中,添加所有同步任务,当遇到异步任务,并且异步任务满足执行条件时,将异步任务添加入任务队列之中,在执行栈中的所有任务执行完后,查询任务队列中是否有任务  
1. 将任务队列中最先添加的回调函数压入执行栈中执行
2. 执行完毕后,检查任务队列是否还有回调函数为执行,若有执行 1 , 否则该次程序执行结束



## 4.宏任务和微任务

[宏任务和微任务](https://juejin.im/post/5e80595c518825739f6af6f4#heading-12)

在ES6之后,出现了promise,async等异步的api,之前的事件循环已经明显不太够用,  
> 在回调函数中可能会嵌套某些重要的回调函数,需要立即执行而不是添加入任务队列之中顺序执行
于是开始细化,出现了宏任务和微任务的说法


### 宏任务
包括 script(整体的代码) setTimeout setInterval I/O 操作

### 微任务 
promise.then 注册的任务

### 执行顺序
1. 首先执行同步任务
2. 从宏任务中取出第一个任务开始执行(全局代码)
3. 如果产生了宏任务,将宏任务加入宏任务队列之中等待轮询执行
4. 如何产生了微任务,将微任务加入微任务队列之中
5. 当前宏任务执行完,取出微任务队列中的任务依次执行完毕
6. 假如微任务中产生了微任务时会将微任务添加微任务队列中依次执行
7. 微任务执行完后, 重复执行上述的 2 - 7


